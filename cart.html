<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fresh Picks - Cart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="cart.js" defer></script>
</head>
<body>

<header>
    <h1>Your Cart</h1>
    <h2 class="subtitle">Thank you for shopping with us!</h2>
    <a href="index.html" class="logo">
        <img src="images/logo.png" alt="Fresh Picks Logo">
    </a>
</header>

<nav>
    <a href="index.html">Home</a>
    <a href="fruits.html">Fruits</a>
    <a href="vegetables.html">Vegetables</a>
    <a href="meats.html">Meats</a>
    <a href="preserves.html">Preserves</a>
    <a href="cart.html">Your Cart</a>
    <a href="compare.html">Compare Prices</a>
</nav>

<main class="container my-4">
    <h2>Your Cart</h2>
    <button id="clear-cart-btn" class="btn btn-outline-danger mb-3"
            style="background-color: rgba(246,14,14,0.58); color: rgb(255,255,255)">Clear Cart
    </button>

    <ul id="cart-items" class="list-group mb-3"></ul>

    <div class="d-flex justify-content-between align-items-center">
        <strong>Total:</strong>
        <span id="cart-total" class="fw-bold">$0.00</span>
    </div>

    <button id="checkout-btn" class="btn btn-primary mt-3">Checkout</button>
</main>

<footer>
    &copy; 2025 Fresh Picks. All rights reserved.
</footer>

<script>
    document.addEventListener("DOMContentLoaded", () =>
    {
        const list = document.getElementById("cart-items");
        const totalSpan = document.getElementById("cart-total");

        function renderCart()
        {
            list.innerHTML = "";

            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const aggregated = {};

            cart.forEach(({name, quantity, price}) =>
            {
                if (!aggregated[name])
                {
                    aggregated[name] = {quantity: 0, price};
                }
                aggregated[name].quantity += quantity;
            });

            if (Object.keys(aggregated).length === 0)
            {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.textContent = "Your cart is empty.";
                list.appendChild(li);
                totalSpan.textContent = "$0.00";
                return;
            }

            let grandTotal = 0;

            for (const [name, {quantity, price}] of Object.entries(aggregated))
            {
                const li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";

                const nameQtySpan = document.createElement("span");
                nameQtySpan.textContent = `${name} Ã— ${quantity} @ $${price.toFixed(2)}`;

                const rightDiv = document.createElement("div");
                const itemTotalSpan = document.createElement("span");
                itemTotalSpan.className = "me-3";
                const itemTotal = quantity * price;
                itemTotalSpan.textContent = `$${itemTotal.toFixed(2)}`;

                const removeButton = document.createElement("button");
                removeButton.className = "btn btn-sm btn-danger remove-item";
                removeButton.textContent = "Remove All";
                removeButton.setAttribute("data-name", name);

                rightDiv.appendChild(itemTotalSpan);
                rightDiv.appendChild(removeButton);

                li.appendChild(nameQtySpan);
                li.appendChild(rightDiv);

                list.appendChild(li);

                grandTotal += itemTotal;
            }

            totalSpan.textContent = `$${grandTotal.toFixed(2)}`;
        }

        renderCart();

        list.addEventListener("click", (e) =>
        {
            if (e.target.classList.contains("remove-item"))
            {
                const itemName = e.target.getAttribute("data-name");
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart = cart.filter(item => item.name !== itemName);
                localStorage.setItem("cart", JSON.stringify(cart));
                renderCart();
            }
        });

        document.getElementById("clear-cart-btn").addEventListener("click", () =>
        {
            localStorage.removeItem("cart");
            renderCart();
        });

        document.getElementById("checkout-btn").addEventListener("click", () =>
        {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0)
            {
                alert("Your cart is empty!");
                return;
            }

            let cartSummary = '';
            let totalCost = 0;

            cart.forEach(item =>
            {
                cartSummary += `${item.name} - $${item.price.toFixed(2)} ||| `;
                totalCost += item.price;
            });

            cartSummary += `\n\nTotal: $${totalCost.toFixed(2)}`;

            alert(`You bought:\n\n${cartSummary}`);

            localStorage.removeItem("cart");
            renderCart();
        });
    });
</script>

</body>
</html>
